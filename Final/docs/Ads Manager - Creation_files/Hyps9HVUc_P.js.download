if (self.CavalryLogger) { CavalryLogger.start_js(["ClwbL"]); }

__d("NotificationCounter",["Arbiter","CrossWindowEventEmitter","DocumentTitle","JSLogger","MessengerEnvironment"],(function(a,b,c,d,e,f){__p&&__p();var g=new(b("CrossWindowEventEmitter"))("JewelBase"),h={messages:0,notifications:0,requests:0};a={init:function(){b("Arbiter").subscribe("update_title",this._handleUpdate.bind(this)),b("Arbiter").subscribe("jewel/count-updated",this._handleCountUpdate.bind(this)),g.addListener("count-updated",function(a){this._handleCountUpdate("",a)}.bind(this))},getCount:function(){__p&&__p();var a=0;for(var c in h){var d=Number(h[c]);if(typeof h[c]==="string"&&isNaN(d))return h[c];if(isNaN(d)||d<0){b("JSLogger").create("jewels").error("bad_count",{jewel:c,count:h[c]});continue}a+=d}return a},updateTitle:function(){if(b("MessengerEnvironment").messengerui)return;var a=this.getCount();b("DocumentTitle").badge(a)},_handleCountUpdate:function(a,b){h[b.jewel]=b.count,this.updateTitle()},_handleUpdate:function(a,b){this.updateTitle()}};e.exports=a}),null);
__d("XWorkHubController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/hub/{?tab}/{?alert_id}/",{ref:{type:"String"},tab:{type:"String"},selected_key:{type:"String",defaultValue:"app_401904056828201"},alert_id:{type:"String"},mini:{type:"Bool",defaultValue:!1}})}),null);
__d("NotificationJewelController",["Arbiter","Bootloader","Event","EventProfiler","FunnelLogger","IndeterminateNotificationCounter","NotificationConstants","NotificationCounter","NotificationJewelFunnelLoggingConstants","NotificationListConfig","NotificationSeenState","NotificationStore","NotificationUpdates","XWorkHubController","clearTimeout","createObjectFrom","curry","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g=b("NotificationConstants").PayloadSourceType,h=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT,i=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,j=0,k=!1,l=!1,m=null;function n(a){var c=b("NotificationSeenState").getUnseenCount();b("Arbiter").inform("jewel/count-updated",{jewel:a,count:c,animation:k&&c>0?"heart":"none"},"state")}function a(a,c){"use strict";__p&&__p();var d=c.badgeAnimationData,e=c.classification,f=c.endPoint,l=c.isBizsite,o=c.list;c=c.unseenNotifs;f&&b("NotificationStore").registerEndpoint({endpointControllerName:f,classification:e});l?b("IndeterminateNotificationCounter").init(c.length):b("NotificationCounter").init();var p=b("Event").listen(a.getRoot(),"mouseover",function(){b("FunnelLogger").startFunnel(i),p&&p.remove(),p=null,b("FunnelLogger").appendAction(i,h.MOUSE_OVER_ON_JEWEL),this.eagerRender(o)}.bind(this));b("NotificationListConfig").eagerRenderJewel&&this.eagerRender(o);var q=null;b("Event").listen(a.getRoot(),"mouseover",function(){q=b("setTimeoutAcrossTransitions")(function(){b("Bootloader").loadModules(["QE2Logger"],function(a){a.logExposureForUser("www_jewel_tooltip_experiment")},"NotificationJewelController"),q=null},500)});b("Event").listen(a.getRoot(),"mouseout",function(){q&&b("clearTimeout")(q)});b("gkx")("678265")&&b("Event").listen(a.getButton(),"click",function(a){if(a.metaKey||a.ctrlKey){a=b("XWorkHubController").getURIBuilder().setString("ref","jewel").setString("tab","all").getURI();window.open(a,"notification_hub_tab_identifier")}});var r=!1,s=a.subscribe("opened",function(){r||(r=!0,b("EventProfiler").tagCurrentActiveInteractionsAs("FirstNotificationJewelOpen")),m&&m(),s&&s.unsubscribe(),s=null,o.open()}),t=o.pause.bind(o);a.subscribe("opened",function(){window.setTimeout(t,0),n(a.name),b("Bootloader").loadModules(["NotificationVPVs"],function(a){return a.clearImpressions()},"NotificationJewelController"),b("Arbiter").inform("notificationJewel/opened")});a.subscribe("closed",function(){o.unpause(),n(a.name),b("Arbiter").inform("notificationJewel/closed"),o.setFlyoutOpenState(!1)});a.subscribe("user-open",function(event,a){o.setFlyoutOpenState(!0)});a.isOpen()&&o.setFlyoutOpenState(!0);(b("NotificationListConfig").eagerOnBadgeUpdate||b("NotificationListConfig").eagerOnBadgeIncreaseFromZero&&a.initialCount===0)&&a.subscribe("updated",function(b,c){c&&c.count>a.initialCount&&this.eagerRender(o)}.bind(this));b("NotificationUpdates").subscribe("seen-state-updated",b("curry")(n,a.name));d&&(d.logWithQEUniverse&&b("Bootloader").loadModules(["QE2Logger"],function(a){return a.logExposureForUser(d.logWithQEUniverse)},"NotificationJewelController"),d.injectWithAnimation&&b("Bootloader").loadModules(["RelationshipDelightsBadge"],function(b){return b.inject(a,d.injectWithAnimation)},"NotificationJewelController"),b("Bootloader").loadModules(["RelationshipDelightUtils"],function(a){b("NotificationUpdates").subscribe("update-notifications",function(b,c){b=c.nodes;c=c.payloadsource;b=b&&b.length?b.filter(a.shouldHeartBadge):null;b&&b.length?(k=!0,d.injectWithAnimation&&((c===g.INITIAL_LOAD||c===g.INITIAL_SEND)&&a.logBadgeAnimation(b[0].alert_id))):k=!1}),d.logWithAlertID&&a.logBadgeAnimation(d.logWithAlertID)},"NotificationJewelController"));b("NotificationUpdates").handleUpdate(g.INITIAL_LOAD,{seenState:b("createObjectFrom")(c,j)});n(a.name);b("Arbiter").inform("jewel_mounted")}a.prototype.eagerRender=function(a){"use strict";l||(l=!0,m=b("EventProfiler").notifyRunningEagerInteraction(["Notifications_Jewel_Button"],"click"),a.open())};e.exports=a}),null);